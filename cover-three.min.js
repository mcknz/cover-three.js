var a=function(){function c(a,b){return a===b}function d(a){return c(a,b)}function e(a,b){if(a!==b.type)throw"invalid type: expected '"+a+"', "+"received '"+b.type+"'"}function f(a){return parseInt(a,10)}function g(b){return e("piece",b),a.square(b.size,b.playerId)}function h(a){return JSON.stringify(a)}function i(a){return JSON.parse(a)}function j(b){a.game.addResetNotification(a.board.reset),a.game.set(b)}"use strict";var b=-1;return{none:b,player1:0,player2:1,smallPiece:0,largePiece:1,isNone:d,equals:c,ensureType:e,toInt:f,toSquare:g,serialize:h,deserialize:i,init:j}}();a.board=function(a){function d(b){var d=c.length-1,e=b.squares,f,g;while(d>=0){g=!1;while(!g){f=e[c[d][0]].playerId;if(a.isNone(f))g=!0;else{if(a.equals(f,e[c[d][1]].playerId)&&a.equals(f,e[c[d][2]].playerId))return f;g=!0}}d-=1}return a.none}function e(a){return b[a]}function f(c,e,f){b[c]=e,f.saveSquare(c,a.toSquare(e)),f.saveCurrentPlayerId(a.equals(e.playerId,a.player1)?a.player2:a.player1),f.saveWinningPlayerId(d(f.get()))}function g(b){return a.ensureType("square",b),a.piece(b.size,b.playerId)}function h(a){var c=a.squares,d;for(d=0;d<9;d+=1)b[d]=g(c[d])}"use strict";var b=[],c=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];return{getSquarePiece:e,setSquarePiece:f,reset:h}}(a),a.game=function(b){function j(){d=b.serialize({type:c,playerId:e,squares:f,over:h,winningPlayerId:i})}function k(a){g.push(a)}function l(a){e=a,j()}function m(a,b){f[a]=b,j()}function n(a){i=a,h=a!==b.none,j()}function o(){return b.deserialize(d)}function p(a){var k=g.length-1;b.ensureType(c,a);if(b.equals(d,b.serialize(a)))return;e=a.playerId,f=a.squares,h=a.over,i=a.winningPlayerId,j();while(k>=0)g[k].call(null,a),k-=1}function q(){var d=a.square(b.none,b.none),e;for(e=0;e<9;e+=1)f[e]=d;return{type:c,playerId:b.player1,squares:f,over:!1,winningPlayerId:a.none}}"use strict";var c="game",d=null,e=b.player1,f=[],g=[],h=!1,i=b.none;return{get:o,set:p,getNew:q,saveCurrentPlayerId:l,saveSquare:m,addResetNotification:k,saveWinningPlayerId:n}}(a),a.piece=function(b,c){function e(e){return a.ensureType(d,e),a.equals(b,e.size)&&a.equals(c,e.playerId)}function f(){return b===a.none?a.smallPiece:a.largePiece}"use strict";var d="piece";return{type:d,size:b,playerId:c,equals:e,getNextSize:f}},a.player=function(b){function d(d){return a.ensureType(c,d),a.equals(b,d.id)}"use strict";var c="player";return{type:c,id:b,equals:d}},a.square=function(a,b){return"use strict",{type:"square",playerId:b,size:a}};